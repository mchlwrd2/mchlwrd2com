<div class="mt-16 border-t border-gray-200 dark:border-gray-700 pt-8">
  <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
    More on {{ tags[0] | capitalize }}
  </h3>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    
    {# 1. Grab the first tag of the current post to find matches #}
    {% set currentTag = tags[0] %}
    
    {# 2. Get posts with that tag and reverse to show newest first #}
    {% set relatedPosts = collections[currentTag] | reverse %}
    
    {# 3. Initialize a counter to limit results #}
    {% set counter = 0 %}

    {% for post in relatedPosts %}
      {# 4. Exclude the current page and limit to 3 items #}
      {% if post.url != page.url and counter < 3 %}
        
        <a href="{{ post.url }}" class="block group">
          <div class="bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-xl p-5 shadow-sm hover:shadow-md transition-shadow duration-200 h-full">
            <h4 class="font-semibold text-gray-800 dark:text-gray-100 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
              {{ post.data.title }}
            </h4>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">
              Read article &rarr;
            </p>
          </div>
        </a>

        {# Increment counter #}
        {% set counter = counter + 1 %}
        
      {% endif %}
    {% endfor %}
    
  </div>
</div>